由于架构差异，同样的代码在虚拟机的运行速度往往慢于实体机。Pafish用RDTSC指令来计算执行一段代码所花费的平均CPU运行周期数。RDTSC 指令可以以极小的代价获得高精度的 CPU 时钟周期数（Time Stamp Counter）。 用法是，先后执行两次RDTSC，记下两个 64-bit 整数 ret 和 ret2，那么 ret2-ret1 代表了这期间 所花费的CPU 时钟周期数。

然后这个取差值的过程重复10次，得到平均值。如果这个平均周期差小于750的话，就认为是实体机环境，否则则认为是虚拟机环境。笔者估计Pafish选择1000作为平均周期差的是根据实践经验。